{"ast":null,"code":"import _defineProperty from\"/Users/lex/Documents/PiXL/Web-Application/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Users/lex/Documents/PiXL/Web-Application/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/lex/Documents/PiXL/Web-Application/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/lex/Documents/PiXL/Web-Application/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{BeaconWallet}from\"@taquito/beacon-wallet\";import{NetworkType,BeaconEvent,defaultEventCallbacks}from\"@airgap/beacon-sdk\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ConnectButton=function ConnectButton(_ref){var Tezos=_ref.Tezos,setContract=_ref.setContract,setWallet=_ref.setWallet,setUserAddress=_ref.setUserAddress,setUserBalance=_ref.setUserBalance,setStorage=_ref.setStorage,contractAddress=_ref.contractAddress,setBeaconConnection=_ref.setBeaconConnection,setPublicToken=_ref.setPublicToken,wallet=_ref.wallet;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loadingNano=_useState2[0],setLoadingNano=_useState2[1];var setup=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(userAddress){var balance,contract,storage;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setUserAddress(userAddress);// updates balance\n_context.next=3;return Tezos.tz.getBalance(userAddress);case 3:balance=_context.sent;setUserBalance(balance.toNumber());// creates contract instance\n_context.next=7;return Tezos.wallet.at(contractAddress);case 7:contract=_context.sent;_context.next=10;return contract.storage();case 10:storage=_context.sent;setContract(contract);// setStorage(storage.toNumber());\ncase 12:case\"end\":return _context.stop();}}},_callee);}));return function setup(_x){return _ref2.apply(this,arguments);};}();var connectWallet=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var userAddress;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return wallet.requestPermissions({network:{type:NetworkType.MAINNET,rpcUrl:\"https://mainnet.api.tez.ie\"}});case 3:_context2.next=5;return wallet.getPKH();case 5:userAddress=_context2.sent;_context2.next=8;return setup(userAddress);case 8:setBeaconConnection(true);_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return function connectWallet(){return _ref3.apply(this,arguments);};}();useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _eventHandlers;var wallet,activeAccount,userAddress;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// creates a wallet instance\nwallet=new BeaconWallet({name:\"Taquito Boilerplate\",preferredNetwork:NetworkType.MAINNET,disableDefaultEvents:true,// Disable all events / UI. This also disables the pairing alert.\neventHandlers:(_eventHandlers={},_defineProperty(_eventHandlers,BeaconEvent.PAIR_INIT,{handler:defaultEventCallbacks.PAIR_INIT}),_defineProperty(_eventHandlers,BeaconEvent.PAIR_SUCCESS,{handler:function handler(data){return setPublicToken(data.publicKey);}}),_eventHandlers)});Tezos.setWalletProvider(wallet);setWallet(wallet);// checks if wallet was connected before\n_context3.next=5;return wallet.client.getActiveAccount();case 5:activeAccount=_context3.sent;if(!activeAccount){_context3.next=13;break;}_context3.next=9;return wallet.getPKH();case 9:userAddress=_context3.sent;_context3.next=12;return setup(userAddress);case 12:setBeaconConnection(true);case 13:case\"end\":return _context3.stop();}}},_callee3);}))();},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"buttons\",children:/*#__PURE__*/_jsx(\"button\",{className:\"button\",onClick:connectWallet,children:/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-wallet\"}),\"\\xA0 Sync Wallet\"]})})});};export default ConnectButton;","map":{"version":3,"sources":["/Users/lex/Documents/PiXL/Web-Application/src/components/ConnectWallet.tsx"],"names":["React","useState","useEffect","BeaconWallet","NetworkType","BeaconEvent","defaultEventCallbacks","ConnectButton","Tezos","setContract","setWallet","setUserAddress","setUserBalance","setStorage","contractAddress","setBeaconConnection","setPublicToken","wallet","loadingNano","setLoadingNano","setup","userAddress","tz","getBalance","balance","toNumber","at","contract","storage","connectWallet","requestPermissions","network","type","MAINNET","rpcUrl","getPKH","console","log","name","preferredNetwork","disableDefaultEvents","eventHandlers","PAIR_INIT","handler","PAIR_SUCCESS","data","publicKey","setWalletProvider","client","getActiveAccount","activeAccount"],"mappings":"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","sourcesContent":["import React, { Dispatch, SetStateAction, useState, useEffect } from \"react\";\nimport { TezosToolkit } from \"@taquito/taquito\";\nimport { BeaconWallet } from \"@taquito/beacon-wallet\";\nimport {\n  NetworkType,\n  BeaconEvent,\n  defaultEventCallbacks\n} from \"@airgap/beacon-sdk\";\nimport TransportU2F from \"@ledgerhq/hw-transport-u2f\";\nimport { LedgerSigner } from \"@taquito/ledger-signer\";\n\ntype ButtonProps = {\n  Tezos: TezosToolkit;\n  setContract: Dispatch<SetStateAction<any>>;\n  setWallet: Dispatch<SetStateAction<any>>;\n  setUserAddress: Dispatch<SetStateAction<string>>;\n  setUserBalance: Dispatch<SetStateAction<number>>;\n  setStorage: Dispatch<SetStateAction<number>>;\n  contractAddress: string;\n  setBeaconConnection: Dispatch<SetStateAction<boolean>>;\n  setPublicToken: Dispatch<SetStateAction<string | null>>;\n  wallet: BeaconWallet;\n};\n\nconst ConnectButton = ({\n  Tezos,\n  setContract,\n  setWallet,\n  setUserAddress,\n  setUserBalance,\n  setStorage,\n  contractAddress,\n  setBeaconConnection,\n  setPublicToken,\n  wallet\n}: ButtonProps): JSX.Element => {\n  const [loadingNano, setLoadingNano] = useState<boolean>(false);\n\n  const setup = async (userAddress: string): Promise<void> => {\n    setUserAddress(userAddress);\n    // updates balance\n    const balance = await Tezos.tz.getBalance(userAddress);\n    setUserBalance(balance.toNumber());\n    // creates contract instance\n    const contract = await Tezos.wallet.at(contractAddress);\n    const storage: any = await contract.storage();\n    setContract(contract);\n    // setStorage(storage.toNumber());\n  };\n\n  const connectWallet = async (): Promise<void> => {\n    try {\n      await wallet.requestPermissions({\n        network: {\n          type: NetworkType.MAINNET,\n          rpcUrl: \"https://mainnet.api.tez.ie\"\n        }\n      });\n      // gets user's address\n      const userAddress = await wallet.getPKH();\n      await setup(userAddress);\n      setBeaconConnection(true);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  useEffect(() => {\n    (async () => {\n      // creates a wallet instance\n      const wallet = new BeaconWallet({\n        name: \"Taquito Boilerplate\",\n        preferredNetwork: NetworkType.MAINNET,\n        disableDefaultEvents: true, // Disable all events / UI. This also disables the pairing alert.\n        eventHandlers: {\n          // To keep the pairing alert, we have to add the following default event handlers back\n          [BeaconEvent.PAIR_INIT]: {\n            handler: defaultEventCallbacks.PAIR_INIT\n          },\n          [BeaconEvent.PAIR_SUCCESS]: {\n            handler: data => setPublicToken(data.publicKey)\n          }\n        }\n      });\n      Tezos.setWalletProvider(wallet);\n      setWallet(wallet);\n      // checks if wallet was connected before\n      const activeAccount = await wallet.client.getActiveAccount();\n      if (activeAccount) {\n        const userAddress = await wallet.getPKH();\n        await setup(userAddress);\n        setBeaconConnection(true);\n      }\n    })();\n  }, []);\n\n  return (\n    <div className=\"buttons\">\n      <button className=\"button\" onClick={connectWallet}>\n        <span>\n          <i className=\"fas fa-wallet\"></i>&nbsp; Sync Wallet\n        </span>\n      </button>\n    </div>\n  );\n};\n\nexport default ConnectButton;\n"]},"metadata":{},"sourceType":"module"}