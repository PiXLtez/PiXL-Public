{"ast":null,"code":"import _regeneratorRuntime from\"/Users/lex/Documents/PiXL/Web-Application/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/lex/Documents/PiXL/Web-Application/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/lex/Documents/PiXL/Web-Application/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import\"../../App.css\";import Unity,{UnityContext}from\"react-unity-webgl\";import{setTimeout}from\"timers\";import{compose}from\"@taquito/taquito\";import{Tzip12Module,tzip12}from\"@taquito/tzip12\";import{Tzip16Module,tzip16}from\"@taquito/tzip16\";import{MintProvider}from\"../../services/mintProvider\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var unityContext=new UnityContext({loaderUrl:\"Build/1.loader.js\",dataUrl:\"Build/1.data\",frameworkUrl:\"Build/1.framework.js\",codeUrl:\"Build/1.wasm\"});var UnityComponent=function UnityComponent(_ref){var Tezos=_ref.Tezos,publicToken=_ref.publicToken,userAddress=_ref.userAddress,userBalance=_ref.userBalance,setUserBalance=_ref.setUserBalance;var mintProvider=new MintProvider();document.onfullscreenchange=function(event){unityContext.setFullscreen(false);};unityContext.on(\"WhereWallet\",function(userName,score){});unityContext.on(\"GameOver\",function(userName,score){});unityContext.on(\"MintThis\",function(itemName,score){if(itemName){mintContract(itemName,score);}});unityContext.on(\"ShareQuest\",function(questDetails,Id){shareQuest(questDetails,Id);});var isCalled=false;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),items=_useState2[0],setItem=_useState2[1];var mintContract=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(itemName,score){var result,tempItems;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return mintProvider.mintItem();case 2:result=_context.sent;tempItems=items;tempItems.push(result);setItem(tempItems);setUserBalance(Math.random());// used to rerender Todo replace with better method\ncase 7:case\"end\":return _context.stop();}}},_callee);}));return function mintContract(_x,_x2){return _ref2.apply(this,arguments);};}();var shareQuest=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(questDetails,Id){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return mintProvider.shareQuest(questDetails,Id);case 2:alert(\"Quest has been shared\");case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function shareQuest(_x3,_x4){return _ref3.apply(this,arguments);};}();var createImageSrc=function createImageSrc(artifactUri){if(artifactUri){return\"https://cloudflare-ipfs.com/ipfs/\"+artifactUri.split(\"//\")[1];}else{return\"error\";}};var buildCards=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(metaDataArray){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.t0=setItem;_context3.next=3;return Promise.all(metaDataArray.map(function(item){return{name:item.name,imageSrc:createImageSrc(item.artifactUri),alt:item.token_id.toString()};}));case 3:_context3.t1=_context3.sent;(0,_context3.t0)(_context3.t1);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function buildCards(_x5){return _ref4.apply(this,arguments);};}();var findOtherCards=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var contractAddress,contract,storage,ledger,metaDataArray;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:contractAddress=\"KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton\";_context5.next=3;return Tezos.contract.at(contractAddress,compose(tzip16,tzip12));case 3:contract=_context5.sent;_context5.next=6;return contract.storage();case 6:storage=_context5.sent;ledger=storage.ledger||storage.accounts;_context5.next=10;return Promise.all([578802,578806,578810,578813].map(/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(number){var val,x;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return ledger.get({0:\"tz1dmSoZi281eKeU4B3W53LrAoqSa8kpCd6w\",1:number});case 2:val=_context4.sent;if(!val){_context4.next=9;break;}_context4.next=6;return contract.tzip12().getTokenMetadata(number);case 6:return _context4.abrupt(\"return\",_context4.sent);case 9:x={token_id:0,decimals:0};return _context4.abrupt(\"return\",x);case 11:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x6){return _ref6.apply(this,arguments);};}()));case 10:metaDataArray=_context5.sent;metaDataArray.filter(function(item){return item.token_id!==0;});if(metaDataArray){buildCards(metaDataArray);}case 13:case\"end\":return _context5.stop();}}},_callee5);}));return function findOtherCards(){return _ref5.apply(this,arguments);};}();var setWalletAddress=function setWalletAddress(){unityContext.send(\"GameController\",\"ConnectWallet\",userAddress);};var addCard=function addCard(id,e,cardId){var element=document.getElementById(id);if(element){element.className=\"card animate__animated animate__backOutUp\";}cardId===\"entry Token\"?unityContext.send(\"GameController\",\"InsertCoin\"):unityContext.send(\"GameController\",\"AddItem\",cardId);findOtherCards();};var findInitialCoin=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var contractAddress,tokenId,contract,storage,ledger,val,x;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:Tezos.addExtension(new Tzip16Module());Tezos.addExtension(new Tzip12Module());contractAddress=\"KT1SGdop74rGobKAETcBPnz9yQkH38hZnpBh\";tokenId=1;_context6.next=6;return Tezos.contract.at(contractAddress,compose(tzip16,tzip12));case 6:contract=_context6.sent;console.log(\"Fetching the token metadata for the token ID \".concat(tokenId,\"...\"));// const metatData = await contract.tzip12().getTokenMetadata(1);\n_context6.next=10;return contract.storage();case 10:storage=_context6.sent;ledger=storage.ledger||storage.accounts;_context6.next=14;return ledger.get({0:\"tz1dmSoZi281eKeU4B3W53LrAoqSa8kpCd6w\",1:1});case 14:val=_context6.sent;if(val){_context6.next=17;break;}return _context6.abrupt(\"return\");case 17:x=[];x.push({name:\"entry token\",imageSrc:\"https://cloudflare-ipfs.com/ipfs/QmPTFsFgEYfS3VV9uaTWfWUQGVqbaHa1t2npBUQZ4NiAvP\",alt:\"entry Token\"});setItem(x);setUserBalance(1);case 21:case\"end\":return _context6.stop();}}},_callee6);}));return function findInitialCoin(){return _ref7.apply(this,arguments);};}();useEffect(function(){if((userAddress===null||userAddress===void 0?void 0:userAddress.length)>1&&!isCalled){isCalled=true;findInitialCoin();setTimeout(function(){setWalletAddress();},10000);}},[userAddress]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center ml-auto mr-auto unity-container\",children:/*#__PURE__*/_jsx(Unity,{unityContext:unityContext,style:{height:\"100%\",width:950,border:\"2px solid black\",background:\"grey\"}})}),items.length>0?/*#__PURE__*/_jsx(\"section\",{className:\"card-list mt-2 ml-auto mr-auto items-center justify-center\",children:items.map(function(user){return/*#__PURE__*/_jsx(\"div\",{id:user.alt,onClick:function onClick(e){return addCard(user.alt,e,user.alt);},className:\"card\",children:/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(e){return addCard(user.alt,e,user.alt);},src:user.imageSrc,alt:\"this slowpoke moves\",width:\"250\"})},user.alt);})}):/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-row ml-auto mr-auto mt-10 w-6/12 h-32 justify-center\",children:/*#__PURE__*/_jsxs(\"h1\",{className:\"text-white \",children:[\" Oh no! We can't find any tokens,Please make sure your wallet is synced and you have purchased the token \",/*#__PURE__*/_jsx(\"a\",{className:\"underline\",href:\"https://objkt.com/asset/KT1SGdop74rGobKAETcBPnz9yQkH38hZnpBh/1\",target:\"_blank\",children:\"here\"})]})})]});};export default UnityComponent;","map":{"version":3,"sources":["/Users/lex/Documents/PiXL/Web-Application/src/components/Unity/UnityComponent.tsx"],"names":["React","useEffect","useState","Unity","UnityContext","setTimeout","compose","Tzip12Module","tzip12","Tzip16Module","tzip16","MintProvider","unityContext","loaderUrl","dataUrl","frameworkUrl","codeUrl","UnityComponent","Tezos","publicToken","userAddress","userBalance","setUserBalance","mintProvider","document","onfullscreenchange","event","setFullscreen","on","userName","score","itemName","mintContract","questDetails","Id","shareQuest","isCalled","items","setItem","mintItem","result","tempItems","push","Math","random","alert","createImageSrc","artifactUri","split","buildCards","metaDataArray","Promise","all","map","item","name","imageSrc","alt","token_id","toString","findOtherCards","contractAddress","contract","at","storage","ledger","accounts","number","get","val","getTokenMetadata","x","decimals","filter","setWalletAddress","send","addCard","id","e","cardId","element","getElementById","className","findInitialCoin","addExtension","tokenId","console","log","length","height","width","border","background","user"],"mappings":"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","sourcesContent":["import React, { Dispatch, SetStateAction, useEffect, useState } from \"react\";\nimport \"../../App.css\";\nimport Unity, { UnityContext } from \"react-unity-webgl\";\nimport { setTimeout } from \"timers\";\nimport { compose, TezosToolkit, MichelsonMap } from \"@taquito/taquito\";\nimport { Tzip12Module, tzip12, TokenMetadata } from \"@taquito/tzip12\";\nimport { Tzip16Module, tzip16 } from \"@taquito/tzip16\";\nimport { BigNumber } from 'bignumber.js';\nimport { MintProvider } from \"../../services/mintProvider\";\n\ntype ButtonProps = {\n    Tezos: TezosToolkit;\n    publicToken: string | null;\n    userAddress: string;\n    userBalance: number;\n    setUserBalance: Dispatch<SetStateAction<number>>;\n};\n\nexport type ItemType = {\n    name: string,\n    imageSrc: string,\n    alt: string\n}\n\nconst unityContext = new UnityContext({\n    loaderUrl: \"Build/1.loader.js\",\n    dataUrl: \"Build/1.data\",\n    frameworkUrl: \"Build/1.framework.js\",\n    codeUrl: \"Build/1.wasm\",\n});\n\nconst UnityComponent = ({\n    Tezos,\n    publicToken,\n    userAddress,\n    userBalance,\n    setUserBalance,\n}: ButtonProps): JSX.Element => {\n    const mintProvider = new MintProvider()\n    document.onfullscreenchange = function (event) {\n        unityContext.setFullscreen(false);\n    };\n    unityContext.on(\"WhereWallet\", function (userName, score) {\n    });\n    unityContext.on(\"GameOver\", function (userName, score) {\n    });\n    unityContext.on(\"MintThis\", function (itemName, score) {\n        if (itemName) {\n            mintContract(itemName, score);\n        }\n    });\n    unityContext.on(\"ShareQuest\", function (questDetails, Id) {\n        shareQuest(questDetails, Id);\n    });\n    let isCalled = false;\n    const [items, setItem] = useState<Array<ItemType>>([]);\n\n    const mintContract = async (itemName: any, score: any) => {\n        const result = await mintProvider.mintItem()\n        const tempItems = items;\n        tempItems.push(result);\n        setItem(tempItems);\n        setUserBalance(Math.random()); // used to rerender Todo replace with better method\n    }\n\n    const shareQuest = async (questDetails:any, Id:any) => {\n        await mintProvider.shareQuest(questDetails,Id);\n        alert(\"Quest has been shared\")\n    }\n\n    const createImageSrc = (artifactUri: string | undefined) => {\n        if (artifactUri) {\n            return \"https://cloudflare-ipfs.com/ipfs/\" + artifactUri.split(\"//\")[1]\n        } else {\n            return \"error\"\n        }\n    }\n\n    const buildCards = async (metaDataArray: TokenMetadata[]) => {\n        setItem(await Promise.all(metaDataArray.map((item) => {\n            return {\n                name: item.name as string,\n                imageSrc: createImageSrc(item.artifactUri) as string,\n                alt: item.token_id.toString(),\n            }\n        })))\n    }\n\n    const findOtherCards = async () => {\n        const contractAddress = \"KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton\";\n        const contract = await Tezos.contract.at(contractAddress, compose(tzip16, tzip12));\n        const storage: any = await contract.storage();\n        const ledger = storage.ledger || storage.accounts;\n        const metaDataArray: TokenMetadata[] = await Promise.all([578802, 578806, 578810, 578813].map(async (number) => {\n            const val = await ledger.get({ 0: \"tz1dmSoZi281eKeU4B3W53LrAoqSa8kpCd6w\", 1: number });\n            if (val) {\n                return await contract.tzip12().getTokenMetadata(number);\n            } else {\n                let x: TokenMetadata = {\n                    token_id: 0,\n                    decimals: 0\n                }\n                return x as TokenMetadata\n            }\n        }))\n\n        metaDataArray.filter((item) => item.token_id !== 0)\n\n        if (metaDataArray) {\n            buildCards(metaDataArray);\n        }\n    }\n\n    const setWalletAddress = () => {\n        unityContext.send(\"GameController\", \"ConnectWallet\", userAddress);\n    }\n\n    const addCard = (id: string, e: React.MouseEvent<HTMLElement, MouseEvent>, cardId: string) => {\n        const element = document.getElementById(id);\n        if (element) {\n            element.className = \"card animate__animated animate__backOutUp\"\n        }\n        cardId === \"entry Token\" ? unityContext.send(\"GameController\", \"InsertCoin\") : unityContext.send(\"GameController\", \"AddItem\", cardId);\n\n        findOtherCards();\n    }\n\n    const findInitialCoin = async () => {\n        Tezos.addExtension(new Tzip16Module());\n        Tezos.addExtension(new Tzip12Module());\n\n        const contractAddress = \"KT1SGdop74rGobKAETcBPnz9yQkH38hZnpBh\";\n        const tokenId = 1;\n        const contract = await Tezos.contract.at(contractAddress, compose(tzip16, tzip12));\n\n        console.log(`Fetching the token metadata for the token ID ${tokenId}...`);\n        // const metatData = await contract.tzip12().getTokenMetadata(1);\n        const storage: any = await contract.storage();\n        const ledger = storage.ledger || storage.accounts;\n        const val = await ledger.get({ 0: \"tz1dmSoZi281eKeU4B3W53LrAoqSa8kpCd6w\", 1: 1 });\n        if (!val) { return }\n        let x = []\n        x.push({\n            name: \"entry token\",\n            imageSrc: \"https://cloudflare-ipfs.com/ipfs/QmPTFsFgEYfS3VV9uaTWfWUQGVqbaHa1t2npBUQZ4NiAvP\",\n            alt: \"entry Token\"\n        })\n        setItem(x)\n        setUserBalance(1);\n    }\n\n    useEffect(() => {\n        if (userAddress?.length > 1 && !isCalled) {\n            isCalled = true;\n            findInitialCoin();\n            setTimeout(() => {\n                setWalletAddress();\n            }, 10000);\n        }\n    }, [userAddress]);\n\n    return (\n        <>\n            <div className=\"flex flex-col items-center ml-auto mr-auto unity-container\">\n                <Unity unityContext={unityContext} style={{\n                    height: \"100%\",\n                    width: 950,\n                    border: \"2px solid black\",\n                    background: \"grey\",\n                }} />\n            </div>\n            {items.length > 0 ?\n                <section className=\"card-list mt-2 ml-auto mr-auto items-center justify-center\">\n                    {items.map((user) => (\n                        <div key={user.alt} id={user.alt} onClick={(e) => addCard(user.alt, e, user.alt)} className=\"card\">\n                            <img onClick={(e) => addCard(user.alt, e, user.alt)} src={user.imageSrc} alt=\"this slowpoke moves\" width=\"250\" />\n                        </div>\n                    ))}\n                </section>\n                : <div className=\"flex flex-row ml-auto mr-auto mt-10 w-6/12 h-32 justify-center\">\n                    <h1 className=\"text-white \"> Oh no! We can't find any tokens,Please make sure your wallet is synced and you have purchased the token <a className=\"underline\" href=\"https://objkt.com/asset/KT1SGdop74rGobKAETcBPnz9yQkH38hZnpBh/1\" target=\"_blank\">here</a></h1>\n                </div>\n            }\n        </>\n    );\n}\n\nexport default UnityComponent"]},"metadata":{},"sourceType":"module"}